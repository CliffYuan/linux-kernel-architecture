<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>per-CPU变量|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 per-CPU变量..." name="description"/>
  <meta content="per-CPU," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/per-cpu/" />
  <meta property="og:title" content="per-CPU变量" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 per-CPU变量..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">daf94cf87</a></li>
  <!--
  I love bettylwx
    -->
</ul>
</div>

<div class="container">

<div class="main clearfix">
  <div class="title">per-CPU变量</div>

  <div class="content 内核同步_content_css">
    <p>最好的同步技术是把设计不需要同步的内核放在首位，因为任何一种同步技术都需要很大的开销。最简单也是最为重要的同步技术有per-CPU变量，这个变量是数组数据结构，系统的每一个CPU都对应一个元素。</p>

<p>一个CPU不应该访问与其他CPU对应的数组元素，另外，它可以随意读或修改自己的元素而不会担心出现竞争状况，因为它是唯一有资格这么做的CPU，因为如果自己的CPU针对自己的数据结构进行修改而会出现竞争状况的话，那将是一个灾难。</p>

<p>但是，这也意味着每个CPU变量基本上只能在特殊的情况下使用，也就是在系统的CPU上的数据结构在逻辑上是独立的时候，per-CPU变量才能够使用。</p>

<p>per-CPU的数组元素在主存中被排列以使每个数据结构存放在硬件高速缓存的不同行，因此，对per-CPU数据结构的并发访问不会导致高速缓存行的窃用和失效，否则会带来非常昂贵的系统开销。</p>

<p>虽然per-CPU变量为来自不同CPU的并发访问提供了保护，但对来自异步函数比如中断处理程序和可延迟函数的访问不能提供保护，在这种情况下需要其他的同步技术。</p>

<p>此外，在单处理器和多处理器的系统中，内核抢占都可能使per-CPU变量产生竞争，总的原则是内核控制路径应该在禁用抢占的情况下访问per-CPU变量。如果不这样，那么可以想象，如果一个内核控制路径获得了一个per-CPU变量，并且引用当前per-CPU变量相应元素的地址。然后因为被抢占而转移到另一个per-CPU变量上，但仍然可能会引用原来的per-CPU变量元素的地址，这样就会产生系统错误。</p>

  </div>

  <hr>
  <div class="eof">EOF</div>
  <hr>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#per-CPU">#per-CPU</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/kernel-preemption/" class="pre">&lt; 内核抢占</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/timing-measurement/" class="next">定时测量 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments 内核同步_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章per-CPU变量写于2014年04月27日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
