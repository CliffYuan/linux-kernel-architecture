<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>进程、轻量级进程和线程|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 进程、轻量级进程和线程..." name="description"/>
  <meta content="线程,轻量级进程," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/process/" />
  <meta property="og:title" content="进程、轻量级进程和线程" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 进程、轻量级进程和线程..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">daf94cf87</a></li>
  <!--
  I love bettylwx
    -->
</ul>
</div>

<div class="container">

<div class="main clearfix">
  <div class="title">进程、轻量级进程和线程</div>

  <div class="content 进程_content_css">
    <h3 id="section">进程</h3>

<p>现在的所有计算机都有进程的概念，它可以让用户觉得计算机是在运行多个程序，而实际上只有CPU个数的进程在工作，如果处理进程之间的调度，是内核非常重要的工作。内核必须要处理好调度工作，让用户有<em>多任务</em>的错觉。</p>

<p>内核进行进程调度，必须解决如下几个问题：</p>

<ol>
  <li>除非明确地要求，否则应用程序不能彼此干扰。</li>
  <li>CPU时间必须在各个应用程序之间尽量公平的共享。</li>
</ol>

<p>上面的两个需求，其中第一个需求，就是存储保护。例如程序A不能干扰程序B的数据空间，不能使用到程序B的内存造成程序B的崩溃。这里必须有两个任务，并且其执行是相对独立的。另外，内核必须决定为各个进程分配多少CPU时间，什么时候切换到下一个进程。这又引出了哪个进程是下一个进程的问题，而且这种解决方法必须是平台无关的。</p>

<p>另外，内核从进程A切换到进程B，需要将进程A的上下文保存起来，并且在下一次恢复到进程A的时候，恢复进程的上下文。进程A不会感知到进程B，可以这么说，进程A会认为自己是计算机中唯一的进程，而且也无需共享空间。为了造成这种错觉，需要在切换和恢复的时候，保留和恢复上下文。这一项工作并不纯粹的是C语言实现，CPU和各种硬件提供了寄存器的访问还需要汇编的帮助。</p>

<p>从内核观点来看，进程的目的就是担当分配系统资源的实体。当一个进程创建时，它几乎与父进程相同，它接受父进程地址空间的一个逻辑拷贝，并从进程创建系统调用的下一条指令开始执行与父进程相同的代码。尽管父子进程可以共享一个内存单元。但子进程的修改对父进程是不可见的。</p>

<h3 id="section-1">线程</h3>

<p>线程可以看做是很多相对独立的执行流，并且共享应用程序的大部分数据结构，在这样的系统中，一个进程由多个用户线程组成，每个线程都代表一个执行流。现在，大部分多线程应用程序都是用<em>pthread</em>（<em>POSIX thread</em>）库的标准函数库编写。</p>

<h3 id="section-2">轻量级进程</h3>

<p>Linux使用轻量级进程（<em>lightweight process</em>）对多线程应用程序提供支持。两个轻量级进程可以共享一些资源，比如地址空间、打开文件。只要其中一个修改共享资源，另一个就能立马感知到这种修改。</p>

<p>实现多线程的应用程序的一个简单方式就是把轻量级进程与每个线程关联起来。这样，线程之间就可以通过简单地共享同一内存地址空间、同一打开文件等来访问相同的应用程序的数据结构。同时，每个线程都可以由内核独立调度，以便一个睡眠的同时另一个仍然是可以运行的。</p>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#线程">#线程</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#轻量级进程">#轻量级进程</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/mm-management/" class="pre">&lt; 内存管理</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/process-descriptor/" class="next">进程描述符 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments 进程_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章进程、轻量级进程和线程写于2014年03月28日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
