<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>可重入内核|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 可重入内核..." name="description"/>
  <meta content="内核,重入,内核控制路径," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/reentrant-kernel/" />
  <meta property="og:title" content="可重入内核" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 可重入内核..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">daf94cf87</a></li>
  <!--
  I love bettylwx
    -->
</ul>
</div>

<div class="container">

<div class="main clearfix">
  <div class="title">可重入内核</div>

  <div class="content 基础_content_css">
    <p>所有的Unix内核都是可重入的（<em>reentrant</em>），这表示若干进程可以同时在内核态下执行。不过，取决于CPU的数量，单核处理器的系统上只有一个进程在真正执行。但是有许多进程可能在等待CPU或者I/O操作完成时在内核状态下被阻塞<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>。</p>

<p>提供可重入的一种方式是编写函数，以便这些函数只能修改局部变量，而不能改变全局的数据结构，这样的函数叫可重入函数。但是可重入内核不仅仅局限于这样的可重入函数，相反，可重入内核可以包含非重入函数。并且利用锁机制保证一次只有一个进程执行一个非重入函数。</p>

<p>如果一个硬件中断发生，可重入内核能挂起当前正在执行的进程，即使这个进程处于内核态。这种能力是非常重要的<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>。一旦设备发出中断，它就一直等待CPU应答，如果内核能够快速应答，设备控制器在CPU处理中断时就能执行其他任务。</p>

<p>在最简单的情况下，CPU从第一条指令到最后一条指令顺序地执行内核控制路径<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>。然而，在当下述事件之一发生时，CPU交错执行内核控制路径：</p>

<ol>
  <li>运行在用户态下的进程调用一个系统调用，而相应的内核控制路径发现这个请求无法立即执行，然后，内核控制路径调用调度程序选择一个新的进程运行。然后，进程发生切换，第一个内核控制路径还未完成，而CPU又重新开始执行其他内核控制路径。在这种情况下，两条控制路径代表两个不同的进程在执行。</li>
  <li>当运行第一个内核控制路径时，CPU监测到一个异常<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup>，第一个控制器被挂起，CPU开始执行合适的过程。</li>
  <li>当CPU正在运行一个启用了中断的内核控制路径时，发生了一个硬件中断。第一个还未执行完，CPU开始执行另一个内核控制路径来处理这个情况，直到完成。完成后第一个控制路径恢复。</li>
  <li>在支持抢占式调度的内核中，可能一个更高优先级的进程进入调度队列，则CPU同样中断第一个执行控制路径，优先响应更高优先级的进程。</li>
</ol>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>例如当内核代表某一进程发出一个磁盘请求后，就让磁盘控制器处理这个请求并恢复其他进程。当设备满足了该请求时，一个硬件中断会通知内核，从而以前的进程可以恢复执行。 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>这样可以提高发出中断设备控制器的吞吐量。 <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>内核控制路径（<em>kernel control path</em>）表示内核处理系统调用、异常或中断所执行的指令序列。 <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>例如访问不存在的页，或者虚拟内存地址越界等等。 <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#内核">#内核</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#重入">#重入</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#内核控制路径">#内核控制路径</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/progress-model/" class="pre">&lt; 进程内核模式</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/consistent-of-kernel/" class="next">内核一致性 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments 基础_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章可重入内核写于2014年03月16日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
