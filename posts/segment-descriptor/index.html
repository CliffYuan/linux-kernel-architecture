<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>段描述符|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 段描述符..." name="description"/>
  <meta content="段描述符,全局描述符表,代码段,数据段,任务状态段,TSS," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/segment-descriptor/" />
  <meta property="og:title" content="段描述符" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 段描述符..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">Home</a></li>
  <li><a href="/archive/">Archive</a></li>
  <li><a href="/linux-kernel-architecture/archive/">Kernel</a></li>
</ul>

</div>

<div class="container">

<div class="main clearfix">
  <div class="title">段描述符</div>

  <div class="content mm内存寻址_content_css">
    <p>每个段由一个8字节的段描述符（<em>Segment Descriptor</em>）表示，它描述了段的特征。段描述符放在全局描述符表（<em>Global Descriptor Table，GDT</em>）或局部描述符表（<em>Local Descriptor Table，LDT</em>）中。</p>

<p>通常只定义一个GDT，而每个进程除了存放在GDT中的段之外如果还需要创建附加的段，可以拥有自己的LDT。GDT在主存中的地址和大小存在<em>gdtr</em>控制寄存器中，当前正被使用的LDT地址和大小放在<em>ldtr</em>控制寄存器中。</p>

<p>有几种不同类型的段以及它们对应的段描述符，下面列出了Linux中广泛采用的类型：</p>

<h3 id="section">代码段描述符</h3>

<p>表示这个段描述符代表一个代码段，它可以放在GDT或LDT中。该描述符置S标志为1，并且为非系统段。</p>

<h3 id="section-1">数据段描述符</h3>

<p>表示这个段描述符代表一个数据段，它可以放在GDT或LDT中。该描述符置S标志为1，栈段是通过数据段实现的。</p>

<h3 id="tssd">任务状态段描述符（<em>TSSD</em>）</h3>

<p>表示这个段描述符代表一个任务状态段（<em>Task State Segment，TSS</em>），也就是说这个段用于保存处理器寄存器的内容。它只能出现在GDT中。根据相应的进程是否正在CPU上运行，其Type字段的值分别为11或9。这个描述符的S标志被置为0。</p>

<h3 id="ldtd">局部描述符表描述符（<em>LDTD</em>）</h3>

<p>这个表示段描述符代表一个包含LDT的段，他置出现在GDT中。相应的Type字段的值为2，S标志被置为0。</p>

<p class="center"><img src="/linux-kernel-architecture/images/segment_descriptor.png" alt="system" /></p>

<p class="center">段描述符示意图</p>

<p>相应字段的意义如下：</p>

<table>
  <thead>
    <tr>
      <th>字段名</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Base</td>
      <td>包含段的首字节的线性地址</td>
    </tr>
    <tr>
      <td>G</td>
      <td>粒度标志，如果为0，则段大小以字节为单位，否则以4096字节的倍数计算</td>
    </tr>
    <tr>
      <td>Limit</td>
      <td>存放段最后一个内存单元的偏移量，从而决定段的长度。如果G被置为0，则一个段的大小在一个字节到1MB之间变化，否则，将在4KB到4GB之间变化</td>
    </tr>
    <tr>
      <td>S</td>
      <td>系统标志，如果被置为0，则这是一个系统段，否则为普通的代码段或者数据段</td>
    </tr>
    <tr>
      <td>Type</td>
      <td>描述了段的类型特征和它的存取权限</td>
    </tr>
    <tr>
      <td>DPL</td>
      <td>描述符特权等级字段，用于限制这个段的存取。它表示为访问这个段而要求的CPU最小的优先级，因此DPL设置为0的段只能当CPL为0时，也就是内核态才可以访问。DPL设为3则堆任何CPL值都是可访问的</td>
    </tr>
    <tr>
      <td>P</td>
      <td><em>Segment-Present标志</em>，等于0表示段当前不在主存中。Linux总是把此标志设为1，因为Linux从来不把整个段交换到磁盘上去</td>
    </tr>
    <tr>
      <td>D或B</td>
      <td>称为D或B标志，取决于是代码段还是数据段，D和B的含义在两种情况下有区别，如果段偏移量的地址是32位长，就基本上把它设置为1，如果偏移量是16位长，则清零</td>
    </tr>
    <tr>
      <td>AVL</td>
      <td>可以由操作系统使用，但是被Linux忽略</td>
    </tr>
  </tbody>
</table>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#段描述符">#段描述符</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#全局描述符表">#全局描述符表</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#代码段">#代码段</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#数据段">#数据段</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#任务状态段">#任务状态段</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#TSS">#TSS</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/segment-selector/" class="pre">&lt; 段选择符和段寄存器</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/visit-segment-descriptor/" class="next">访问段描述符及分段单元 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments mm内存寻址_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章段描述符写于2014年04月14日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
