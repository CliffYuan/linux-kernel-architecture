<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>软中断和tasklet|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 软中断和tasklet..." name="description"/>
  <meta content="软中断,tasklet," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/soft-irq-and-tasklet/" />
  <meta property="og:title" content="软中断和tasklet" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 软中断和tasklet..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">Home</a></li>
  <li><a href="/archive/">Archive</a></li>
  <li><a href="/linux-kernel-architecture/archive/">Kernel</a></li>
</ul>

</div>

<div class="container">

<div class="main clearfix">
  <div class="title">软中断和tasklet</div>

  <div class="content interrupt中断和异常_content_css">
    <p>在由内核执行的几个任务之间有些不是紧急的，在必要的情况下它们可以被推迟一段时间。一个中断处理程序的几个中断服务例程之间时串行执行的，并且通常在一个中断的处理程序结束前，不应该再次出现这个中断。</p>

<p>相反，可延迟中断可以在开中断的情况下执行，把可延迟中断从中断处理程序中抽出来有助于内核保持较短的响应时间。这对于哪些期望它们的中断能在几号秒内大刀处理的『急迫』应用来说是非常重要的。Linux 2.6通过可延迟函数和工作队列来执行的函数来实现以上问题。</p>

<p>软中断和tasklet有密切的关系，tasklet是在软中断之上的实现，事实上，出现在内核代码中的术语软中断（<em>softirq</em>）通常表示可延迟函数的所有种类，另外一种被广泛使用的术语是『中断上下文』，中断上下文表示当前正在执行一个中断处理程序或一个可延迟的函数。</p>

<p>软中断的分配是静态的，即在编译时定义的，而tasklet的分配和初始化可以在运行时进行。软中断可以并发地运行在多个CPU上，因此软中断是可重入函数并且必须明确地使用自旋锁保护其数据结构。但tasklet不必担心这些问题，因为内核对tasklet的执行进行了更加严格的控制。</p>

<p>相同类型的tasklet总是被串行地执行，所以说不能在两个CPU上同事运行相同类型的tasklet，但是类型不同的tasklet可以在几个CPU上并发执行。tasklet的串行化使tasklet函数不必是可重入的，因此简化了驱动设备程序开发者的工作。</p>

<p>一般而言，在可延迟函数上可以执行四种操作：</p>

<p><strong>初始化</strong>（<em>initialization</em>）</p>

<p>定义一个新的可延迟函数，这个操作通常在内核自身初始化或加载模块时进行。</p>

<p><strong>激活</strong>（<em>activation</em>）</p>

<p>标记一个可延迟函数为『挂起』，激活可以在任何时候进行，即便正在处理中断。</p>

<p><strong>屏蔽</strong>（<em>masking</em>）</p>

<p>有选择地屏蔽一个可延迟函数，这样，即使它被激活，内核也不执行它。</p>

<p><strong>执行</strong>（<em>execution</em>）</p>

<p>执行一个挂起的可延迟函数和同类型的其他所有挂起的可延迟函数，执行是在特定的时间进行的。</p>

<p>激活和执行总是捆绑在一起的。由给定CPU激活的一个可延迟函数必须在同一个CPU上执行，不过并没有什么明显的理由说明这条规则是对系统有益的。把可延迟函数绑定在激活CPU上从理论上说可以更好地利用CPU地硬件高速缓存，毕竟，激活地内核线程访问一些数据结构，可延迟函数也可能会使用。</p>

<p>然而，当可延迟函数运行时，因为它地执行可能延迟一段时间，因此相关地高速缓存行可能就根本不再高速缓存中了，因此，帮一个函数绑定在一个CPU上总是有潜在『危险』的操作，因为一个CPU可能忙死而其他CPU又无所事事。</p>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#软中断">#软中断</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#tasklet">#tasklet</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/slab/" class="pre">&lt; slab分配器</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/kernel-mm-management/" class="next">内核中的内存管理 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments interrupt中断和异常_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章软中断和tasklet写于2014年05月07日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
