<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>Linux计时体系结构|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 Linux计时体系结构..." name="description"/>
  <meta content="计时," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/timing-in-linux/" />
  <meta property="og:title" content="Linux计时体系结构" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 Linux计时体系结构..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">Home</a></li>
  <li><a href="/archive/">Archive</a></li>
  <li><a href="/linux-kernel-architecture/archive/">Kernel</a></li>
</ul>

</div>

<div class="container">

<div class="main clearfix">
  <div class="title">Linux计时体系结构</div>

  <div class="content 定时测量_content_css">
    <p>Linux必定执行与定时相关额度操作，所以内核会周期性地做如下操作：</p>

<ol>
  <li>更新自系统启动一来所经过的时间。</li>
  <li>更新时间和日期。</li>
  <li>确定当前进程在每个CPU上已经运行了多长时间，如果已经超过了分配给它的时间，则抢占它。</li>
  <li>更新资源使用统计数。</li>
  <li>检查每个软定时器的时间间隔是否已经达到。</li>
</ol>

<p>Linux的计时体系结构是一组与时间流相关的内核数据结构和函数。实际上，基于80x86多处理器机器所具有的计时体系结构与单处理器机器所具有的稍有不同：</p>

<ol>
  <li>在单处理器系统上，所有的计时活动都是由全局定时器<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>产生的中断触发的。</li>
  <li>再多处理器系统上，所有普通的活动，像软定时器的处理，都是由全局定时器产生的中断触发的，而具体CPU的活动，类似监控当前运行进程的执行时间是由本地APIC定时器产生的中断触发的。</li>
</ol>

<p>可惜，以上两种情况的区别有点模糊，例如，某些早期基于Intel 80486处理器的SMP系统不拥有本地APIC。即使到了今天，还有一些SMP主板有瑕疵，因此本地时钟中断根本不文档。在这些情况下，SMP内核必须采用单处理器系统的计时体系结构。另一方面，新近的单处理器系统拥有本地APIC，因此UP内核通常可以使用SMP的计时体系结构。</p>

<p>Linux的计时体系结构还依赖于时间戳计数器TSC、ACPI电源管理定时器、高精度事件定时器HPET的可用性。内核使用两个基本的计时函数，一个保持当前最新的时间，另一个计算再当前秒内走过的纳秒数。</p>

<p>有几种不同的方式获得后一个值，如果CPU有TSC或HPET，就可以用一些更精确的方法，在其他情况下，使用精确性差一些的方法。</p>

<h3 id="section">计时体系结构的数据结构</h3>

<p>计时是体系结构相关的，所以我们只关心80x86体系结构下最重要的变量。</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>可以是可编程间隔定时器也可以是高精度事件定时器。 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#计时">#计时</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/memory-barrier/" class="pre">&lt; 优化和内存屏障</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/buddy-system-struct/" class="next">伙伴系统的结构 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments 定时测量_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章Linux计时体系结构写于2014年04月29日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
