<!DOCTYPE HTML>
<html>
<!-- <html> -->
<head>
  <title>访问段描述符及分段单元|Linux Kernel Architecture 内核笔记</title>
  <meta charset="utf-8" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/feed.xml">
<link rel="icon" href="/images/icons/avatar.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/css/bootstrap.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style/css/syntax.css" type="text/css" media="screen">
<script type="text/javascript" src="/style/jquery-1.7.1.min.js"></script>


<link rel="stylesheet" href="/style/style.css" type="text/css">

<script>
$(document).ready(function(){
    $('.nav a').hover(
        function(){
            $(this).animate({opacity: 0.3}, 400)
        }, 
        function(){
            $(this).animate({opacity: 1}, 400)
        });
});
function getURLParameter(name) {
    return decodeURI(
        (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
    );
}
</script>

<style>
.archive li {
    list-style: decimal;
    margin-left: 50px;
    line-height: 2em;
}

.archive .year {
    list-style: none;
}
</style>
  <script type="text/javascript">
        var BYB = {};
  </script>
  <script type="text/javascript">
    BYB.includeScript = function(file,callback){
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    
    if (!/*@cc_on!@*/0) { //if not IE
    //Firefox2、Firefox3、Safari3.1+、Opera9.6+ support js.onload
    js.onload = function () {
    callback();
    }
    } else {
    //IE6、IE7 support js.onreadystatechange
    js.onreadystatechange = function () {
    if (js.readyState == 'loaded' || js.readyState == 'complete') {
    callback();
    }
    }
    }
    return false;
    }
  </script>
  <meta content="linux kernel architecture 内核笔记 快速访问段描述符..." name="description"/>
  <meta content="段描述符,分段单元," name="keywords"/>
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://guojing.me/linux-kernel-architecture//posts/visit-segment-descriptor/" />
  <meta property="og:title" content="访问段描述符及分段单元" />
  <meta property="og:description" content="linux kernel architecture 内核笔记 快速访问段描述符..." />
</head>
<body>

<div class="banner">
<ul class="nav nav-pills">
  <li><a href="/">daf94cf87</a></li>
  <!--
  I love bettylwx
    -->
</ul>
</div>

<div class="container">

<div class="main clearfix">
  <div class="title">访问段描述符及分段单元</div>

  <div class="content 内存寻址_content_css">
    <p>由于逻辑地址由16位段选择符和32位偏移量组成，段寄存器仅仅存放段选择符。为了加速逻辑地址到线性地址的转换，80x86处理器提供一种附加的非编程的寄存器<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>，供6个可编程的段寄存器使用。每一个非编程的寄存器含有8个字节的段描述符，由相应的段寄存器中的段选择符来指定。</p>

<h3 id="section">快速访问段描述符</h3>

<p>每当一个段选择符被装入段寄存器时，相应的段描述符就由内存装入到对应的非编程CPU寄存器。从那时起，针对那个段的逻辑地址转换就可以不访问主存中的GDT或LDT。处理器只需直接引用存放段描述符的CPU寄存器即可。只有当段寄存器的内容改变时，才有必要访问GDT或LDT。</p>

<p class="center"><img src="/linux-kernel-architecture/images/visit_segment.png" alt="system" style="max-width:500px" /></p>

<p class="center">快速访问段描述符</p>

<p>由于一个段描述符是8字节长，因此它在GDT或LDT内的相对地址是由段选择符的最高13位的值乘以8<sup id="fnref:3"><a href="#fn:3" class="footnote">2</a></sup>得到的。例如如果GDT在0x00020000<sup id="fnref:2"><a href="#fn:2" class="footnote">3</a></sup>，且由段选择符所指定的索引号为2，即段选择符中的index值为2.那么相应的段描述符地址是0x00020000 + (2*8)。能够保存在GDT中的段描述符的最大数目是8191，即2^13-1。</p>

<p>这样就可以在GDT中找到段描述符的地址。</p>

<h3 id="section-1">分段单元</h3>

<p>下图显示了一个逻辑地址是怎样转换成相应的线性地址。</p>

<p class="center"><img src="/linux-kernel-architecture/images/segmentation.png" alt="system" style="max-width:600px" /></p>

<p>分段单元执行的操作</p>

<p>分段单元（<em>segmentation</em>）执行下列操作：</p>

<p>先检查段选择符中的TI字段，以决定段描述符保存在哪一个描述符表中，TI=1则在LDT中，TI=0则在GDT中。如果在GDT中，分段单元从<em>gdtr</em>寄存器中得到GDT的线性地址，否则从<em>ldtr</em>寄存器中得到LDT的线性地址。</p>

<p>从段选择符的<em>index</em>字段计算段描述符的地址，<em>index</em>字段的值乘以8，这个结果与<em>gdtr</em>或<em>ldtr</em>的内容相加。</p>

<p>把逻辑地址的偏移量与段描述符的<em>Base</em>字段的值相加就得到了线性地址。</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>一个不能被程序员所设置的寄存器。 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>一个段描述符的大小。 <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>这个值保存在gdtr寄存器中。 <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="forb">
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#段描述符">#段描述符</a>
  
  <a href="http://guojing.me/linux-kernel-architecture/tags/#分段单元">#分段单元</a>
  
  </div>

  <div class="suggest">
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/segment-descriptor/" class="pre">&lt; 段描述符</a>
    
    
    
        <a href="http://guojing.me/linux-kernel-architecture/posts/segment-in-linux/" class="next">Linux中的分段 &gt;</a>
    
    </div>
</div>

<!--
<div class="comments 内存寻址_comments_css">
<div id="disqus_container"> 
    
    <a href="#" class="comment" onclick="return false;">点击评论或查看评论。</a>
        
    <div id="disqus_thread"></div>
</div>
</div>
-->

<script type="text/javascript">
    $(document).ready(function(){
        $('#disqus_container .comment').on('click',function(){
            $(this).html('加载中...');
    var disqus_shortname = 'jguoer';
            var that = this;
            BYB.includeScript('http://' + disqus_shortname + '.disqus.com/embed.js',function(){$(that).remove()});
        });
});
</script>

<!--
  Copryright GuoJing 未经允许，严禁直接从Github上转载我的文章，所有文章遵循CC协议，允许复制和转载，但需要保留原作者链接。
  该文章访问段描述符及分段单元写于2014年04月14日。
-->

</div>
<div class="footer">
<!--
    Copyright GuoJing, Theme designed by GuoJing
    Theme name Simple
    If you love this theme, please keep my copyright and link to my blog.
    If you DON'T LIKE it and you CAN remove the link. but not share spirit.
    如果你喜欢这个博客构架和皮肤，请保留我作为原作者的权利，我会感谢你。
    你也可以不保留我作为原作者的权利，自然没有任何问题，但似乎没有共享精神。
-->
<!-- © Copryright by<a href="http://guojing.me/" target="_blank">GuoJing</a> 2012-2014 using <a href="http://www.github.com/" target="_blank">GitHub</a> and <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> -->
<div class="author">
    <div class="icon">
        <img src="/images/authors/guojing.jpg" alt="me"/>
    </div>
    <div class="name">
        <a href="/about">GuoJing</a>
    </div>
    <div class="description">
        Linux Kernel Architecture 内核笔记
    </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42721249-1', 'guojing.me');
  ga('send', 'pageview');

</script>
</div>

</body>
</html>
